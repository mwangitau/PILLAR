{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user's profile within the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile.",
          "format": "uuid"
        },
        "firstName": {
          "type": "string",
          "description": "The user's first name."
        },
        "lastName": {
          "type": "string",
          "description": "The user's last name."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "creationDate": {
          "type": "string",
          "description": "The date and time the user profile was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "creationDate"
      ]
    },
    "GeneratedPlan": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "GeneratedPlan",
      "type": "object",
      "description": "Represents a personalized plan generated by the AI engine.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the generated plan.",
          "format": "uuid"
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N GeneratedPlan)"
        },
        "planData": {
          "type": "string",
          "description": "JSON string containing the detailed plan data."
        },
        "generationDate": {
          "type": "string",
          "description": "The date and time the plan was generated.",
          "format": "date-time"
        },
        "promptTemplateId": {
          "type": "string",
          "description": "Reference to PromptTemplate. (Relationship: PromptTemplate 1:N GeneratedPlan)"
        }
      },
      "required": [
        "id",
        "userId",
        "planData",
        "generationDate",
        "promptTemplateId"
      ]
    },
    "PromptTemplate": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PromptTemplate",
      "type": "object",
      "description": "Represents a prompt template used by the AI to generate plans.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the prompt template.",
          "format": "uuid"
        },
        "name": {
          "type": "string",
          "description": "Name of the prompt template."
        },
        "templateText": {
          "type": "string",
          "description": "The actual prompt template text."
        },
        "description": {
          "type": "string",
          "description": "A description of what this template is used for."
        }
      },
      "required": [
        "id",
        "name",
        "templateText",
        "description"
      ]
    },
    "Habit": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Habit",
      "type": "object",
      "description": "Represents a user-defined habit.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the habit.",
          "format": "uuid"
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Habit)"
        },
        "name": {
          "type": "string",
          "description": "The name of the habit."
        },
        "description": {
          "type": "string",
          "description": "A description of the habit."
        },
        "schedule": {
          "type": "string",
          "description": "JSON string representing the habit's schedule (e.g., days of the week, time of day)."
        }
      },
      "required": [
        "id",
        "userId",
        "name",
        "description",
        "schedule"
      ]
    },
    "HabitLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "HabitLog",
      "type": "object",
      "description": "Represents a log entry for a specific habit.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the habit log entry.",
          "format": "uuid"
        },
        "habitId": {
          "type": "string",
          "description": "Reference to Habit. (Relationship: Habit 1:N HabitLog)"
        },
        "logDate": {
          "type": "string",
          "description": "The date and time the habit was logged.",
          "format": "date-time"
        },
        "completed": {
          "type": "boolean",
          "description": "Indicates whether the habit was completed on this log date."
        }
      },
      "required": [
        "id",
        "habitId",
        "logDate",
        "completed"
      ]
    },
    "JournalEntry": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "JournalEntry",
      "type": "object",
      "description": "Represents a journal entry created by the user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the journal entry.",
          "format": "uuid"
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N JournalEntry)"
        },
        "entryDate": {
          "type": "string",
          "description": "The date and time the journal entry was created.",
          "format": "date-time"
        },
        "content": {
          "type": "string",
          "description": "The text content of the journal entry."
        },
        "mood": {
          "type": "string",
          "description": "The mood associated with the journal entry (e.g., happy, sad, angry)."
        }
      },
      "required": [
        "id",
        "userId",
        "entryDate",
        "content",
        "mood"
      ]
    },
    "AccountabilityPartner": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AccountabilityPartner",
      "type": "object",
      "description": "Represents an accountability partner relationship between two users.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the accountability partner relationship.",
          "format": "uuid"
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. The user initiating the accountability relationship. (Relationship: UserProfile 1:N AccountabilityPartner)"
        },
        "partnerId": {
          "type": "string",
          "description": "Reference to UserProfile. The user who is the accountability partner. (Relationship: UserProfile 1:N AccountabilityPartner)"
        },
        "permissionLevel": {
          "type": "string",
          "description": "The level of permissions granted to the accountability partner (e.g., view only, edit)."
        },
        "consentDate": {
          "type": "string",
          "description": "The date and time the accountability partner consented to the relationship.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "partnerId",
        "permissionLevel",
        "consentDate"
      ]
    },
    "FinanceTransaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "FinanceTransaction",
      "type": "object",
      "description": "Represents a financial transaction.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the financial transaction.",
          "format": "uuid"
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N FinanceTransaction)"
        },
        "transactionDate": {
          "type": "string",
          "description": "The date and time of the transaction.",
          "format": "date-time"
        },
        "amount": {
          "type": "number",
          "description": "The amount of the transaction."
        },
        "category": {
          "type": "string",
          "description": "The category of the transaction (e.g., income, expense, tithe)."
        },
        "description": {
          "type": "string",
          "description": "A description of the transaction."
        }
      },
      "required": [
        "id",
        "userId",
        "transactionDate",
        "amount",
        "category",
        "description"
      ]
    },
    "ExportedReport": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ExportedReport",
      "type": "object",
      "description": "Represents a user-generated report exported from the app.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the exported report.",
          "format": "uuid"
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N ExportedReport)"
        },
        "reportType": {
          "type": "string",
          "description": "The type of report (e.g., manual, accountability report, journal, finance summary)."
        },
        "generationDate": {
          "type": "string",
          "description": "The date and time the report was generated.",
          "format": "date-time"
        },
        "fileUrl": {
          "type": "string",
          "description": "The URL of the generated report file (e.g., on S3).",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "userId",
        "reportType",
        "generationDate",
        "fileUrl"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. Path-based ownership enforced by the `userId` parameter.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/generated_plans/{planId}",
        "definition": {
          "entityName": "GeneratedPlan",
          "schema": {
            "$ref": "#/backend/entities/GeneratedPlan"
          },
          "description": "Stores AI-generated plans for each user. Includes `userId` for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "planId",
              "description": "The unique identifier for the generated plan."
            }
          ]
        }
      },
      {
        "path": "/prompt_templates/{promptTemplateId}",
        "definition": {
          "entityName": "PromptTemplate",
          "schema": {
            "$ref": "#/backend/entities/PromptTemplate"
          },
          "description": "Stores prompt templates used by the AI engine.  Different security rules would govern access (e.g., read-only for authenticated users).",
          "params": [
            {
              "name": "promptTemplateId",
              "description": "The unique identifier for the prompt template."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/habits/{habitId}",
        "definition": {
          "entityName": "Habit",
          "schema": {
            "$ref": "#/backend/entities/Habit"
          },
          "description": "Stores user-defined habits. Includes `userId` for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "habitId",
              "description": "The unique identifier for the habit."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/habits/{habitId}/habit_logs/{habitLogId}",
        "definition": {
          "entityName": "HabitLog",
          "schema": {
            "$ref": "#/backend/entities/HabitLog"
          },
          "description": "Stores log entries for user habits. Inherits authorization from the parent `Habit` document.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "habitId",
              "description": "The unique identifier for the habit."
            },
            {
              "name": "habitLogId",
              "description": "The unique identifier for the habit log entry."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/journal_entries/{journalEntryId}",
        "definition": {
          "entityName": "JournalEntry",
          "schema": {
            "$ref": "#/backend/entities/JournalEntry"
          },
          "description": "Stores user-created journal entries. Includes `userId` for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "journalEntryId",
              "description": "The unique identifier for the journal entry."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/accountability_partners/{accountabilityPartnerId}",
        "definition": {
          "entityName": "AccountabilityPartner",
          "schema": {
            "$ref": "#/backend/entities/AccountabilityPartner"
          },
          "description": "Stores accountability partner relationships.  Includes `userId` for authorization independence. Consider restructuring if granular sharing is needed.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "accountabilityPartnerId",
              "description": "The unique identifier for the accountability partner relationship."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/finance_transactions/{financeTransactionId}",
        "definition": {
          "entityName": "FinanceTransaction",
          "schema": {
            "$ref": "#/backend/entities/FinanceTransaction"
          },
          "description": "Stores financial transactions for each user. Includes `userId` for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "financeTransactionId",
              "description": "The unique identifier for the finance transaction."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/exported_reports/{exportedReportId}",
        "definition": {
          "entityName": "ExportedReport",
          "schema": {
            "$ref": "#/backend/entities/ExportedReport"
          },
          "description": "Stores exported reports generated by users. Includes `userId` for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "exportedReportId",
              "description": "The unique identifier for the exported report."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure security, scalability, and ease of debugging, adhering to the core design principles of Authorization Independence, Clarity of Intent, DBAC, and QAPs. It leverages denormalization, structural segregation, and standardized access modeling.\n\n**Authorization Independence:**  Authorization is achieved without using `get()` calls in security rules by denormalizing authorization data. For instance, the `GeneratedPlan` and other subcollections include the `userId` field, which eliminates the need to fetch the parent `UserProfile` to verify ownership. For collaborative scenarios, such as sharing reports with accountability partners, the structure would include a membership map within the shared document, if needed (although based on the entities provided, this level of collaboration is not explicitly present).\n\n**Structural Segregation:**  Each collection is designed to hold documents with similar security requirements. User-specific data is stored under `/users/{userId}/...`, ensuring that rules can easily enforce ownership. Global prompt templates are stored separately, allowing different access controls.\n\n**Access Modeling:**\n*   **Private Data:**  User profiles and other user-owned data (plans, habits, journal entries, transactions, and reports) follow the `/users/{userId}/...` pattern, ensuring path-based ownership.\n*   **Global Data:** Prompt templates are stored in a top-level collection (`/prompt_templates`), where different rules can govern access (e.g., read-only for all authenticated users, edit access only for admins which are not defined in the entities and would require an additional `/roles_admin/{uid}` collection).\n\n**QAPs (Rules are not Filters):** The segregation of data into different collections based on access requirements prevents the need for filtering data on the client side using security rules. List operations are secure because each collection inherently contains data accessible under the same authorization scope.\n\n**Invariants:** The structure facilitates maintaining invariants by clearly defining ownership through the `userId` field and storing immutable data like creation timestamps within each document. Denormalization helps in keeping data consistent across related documents without relying on complex transactions.\n\n**Example:** To create a new `GeneratedPlan` for a user, the application writes directly to `/users/{userId}/generated_plans/{planId}`. The `userId` within the `GeneratedPlan` document is automatically set to the `{userId}` from the path, which enforces both the correct parent/child relationship and also authorization to read the subcollection based on user id."
  }
}